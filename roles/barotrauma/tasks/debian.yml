---
- name: add 32bit architecture installation for Debian
  import_tasks: debian-32bit.yml

- name: add packages for Debian
  import_tasks: debian-packages.yml

- name: apply hotfixes for Debian
  import_tasks: debian-hotfixes.yml

- name: create btserver user
  user:
    name:  btserver
    shell: /bin/bash
    append: yes
    groups:
      - staff

- name: create Ansible temp directory
  shell:
    cmd: mkdir -p /home/btserver/.ansible/tmp
  become: true
  become_user: btserver

- name: retrieve LinuxGSM script
  get_url:
    url: https://linuxgsm.sh
    dest: /home/btserver/linuxgsm.sh
    mode: '755'
  become: true
  become_user: btserver

- name: install Barotrauma module
  shell:
    cmd: ./linuxgsm.sh btserver
    chdir: /home/btserver
  become: true
  become_user: btserver

- name: install Barotrauma
  shell:
    cmd: ./btserver auto-install
    chdir: /home/btserver
  become: true
  become_user: btserver

- name: ensure local share directory exists
  file:
    path: "/home/btserver/.local/share/Daedalic Entertainment GmbH/Barotrauma"
    state: directory
    mode: 0755
    group: btserver
    owner: btserver

- name: register if a Multiplayer mount exists
  stat:
    path: /data/Multiplayer
  register: multiplayer_mount

- name: link Multiplayer mount
  file:
    src: /data/Multiplayer
    path: "/home/btserver/.local/share/Daedalic Entertainment GmbH/Barotrauma/Multiplayer"
    state: link
  when: multiplayer_mount.stat.exists
