---
- name: add source repository into sources list
  apt_repository:
    repo: deb http://archive.canonical.com/ubuntu jammy multiverse
    state: present

- name: add 32-bit architecture
  lineinfile:
    dest:   /var/lib/dpkg/arch
    line:   "i386"
    create: yes

- name: ensure build dependencies
  apt:
    pkg:
      - apt-transport-https
      - lib32gcc-s1
      - steamcmd
      - wget

- name: download .NET runtime dependencies
  get_url:
    url:  https://packages.microsoft.com/config/ubuntu/22.04/packages-microsoft-prod.deb
    dest: /tmp/packages-microsoft-prod.deb
    mode: '0440'

- name: install .NET runtime repos
  apt:
    deb:  /tmp/packages-microsoft-prod.deb
    sudo: true    

- name: install .NET runtime depdencies
  apt:
    pkg:
      - dotnet-runtime-3.1
    update_cache: yes

- name: create steam user
  user:
    name:  steam
    shell: /bin/bash

- name: ensure config directory exists
  file: path=/home/steam/barotrauma-dedicated/Data state=directory

- name: copy default configuration
  template:
    src:   clientpermissions.xml.j2
    dest:  /home/steam/barotrauma-dedicated/Data/clientpermissions.xml
    owner: steam
    group: steam
    mode:  0644
  notify:
    - reload systemctl
