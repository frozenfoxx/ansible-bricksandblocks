---
- name: Add the sshpass package
  ansible.builtin.apt:
    pkg:
      - sshpass
    update_cache: true
  tags:
    - sshpass

- name: Get user's home directory
  ansible.builtin.getent:
    database: passwd
    key: "{{ sshpass_username }}"
    split: ":"
  register: sshpass_username_info
  tags:
    - sshpass

- name: Create the .sshpass file
  ansible.builtin.copy:
    content: "{{ sshpass_password }}"
    dest: "{{ sshpass_username_info.entries[0].homedir }}/.sshpass"
    owner: "{{ sshpass_username }}"
    group: "{{ sshpass_username }}"
    mode: "0600"
  tags:
    - sshpass
