---
- name: Ensure build dependencies
  apt:
    pkg:
      - gnupg
      - software-properties-common
      - wget

- name: Add the Apt signing key
  apt_key:
    url: http://debian.drdteam.org/drdteam.gpg
    state: present

- name: Add specified repository into sources list
  apt_repository:
    repo: deb http://debian.drdteam.org/ stable multiverse
    state: present

- name: Add the Zandronum package
  apt:
    pkg:
      - zandronum-server

- name: Update the linker to look for the included libraries
  shell: |
    echo '/usr/games/zandronum' > /etc/ld.so.conf.d/zandronum.conf
    ldconfig

- name: Create zandronum user
  user:
    name: zandronum
    shell: /bin/bash

- name: Ensure config directory exists
  file: path=/home/zandronum/.config/zandronum state=directory

- name: Copy default configuration
  copy:
    src: ./
    dest: /home/zandronum/.config/zandronum/
    owner: zandronum
    group: zandronum
    mode: 0644

- name: Add server scripts
  import_tasks: scripts.yml
